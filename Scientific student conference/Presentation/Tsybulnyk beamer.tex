% !TeX program = lualatex
% !TeX encoding = utf8
% !TeX spellcheck = uk_Ua

\documentclass[12pt,mathserif]{beamer}
\usepackage{fontspec}
\setmainfont{CMU serif}
\setsansfont{Arial}
\usepackage[english, ukrainian]{babel}

\usetheme{Boadilla}
\usecolortheme{seahorse}

\makeatletter
\setbeamertemplate{footline}{
    \leavevmode%
    \hbox{%
        % here used "author -> title -> date" color beamer theme/font for fancy gradient looking
        % but hbox filled with \inserttitle -> \insertinstitute -> \insertframenumber
        \begin{beamercolorbox}[wd=0.45\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
            \usebeamerfont{author in head/foot}
            \insertshorttitle
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=0.45\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
            \usebeamerfont{title in head/foot}
            \insertshortinstitute
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=0.1\paperwidth,ht=2.25ex,dp=1ex,center]{date in head/foot}%
            \usebeamerfont{date in head/foot}
            \insertframenumber{} / \inserttotalframenumber
        \end{beamercolorbox}%
    }%
    \vskip0pt%
}

% remove the navigation symbols
\makeatletter
\setbeamertemplate{navigation symbols}{}

\usepackage{tabularray}
\usepackage{mathtools,amsfonts}
\usepackage{bbm} % for using indicator \mathbbm{1} 
\usepackage{xurl}

\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.markings} % fancy arrows on a circle
\usetikzlibrary{bending} % for flexing and bending arrows
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.18}

\usepackage{float}
\usepackage{microtype}
\usepackage{cmap} % make LaTeX PDF output copy-and-pasteable
\usepackage{xcolor}

\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}
\newcommand*{\scaleq}[2][4]{\scalebox{#1}{$#2$}}

\usepackage{amsthm}
\theoremstyle{plain}
\newtheorem{claim}{\indent Твердження}

\title[Оцінювання характеристик ланцюга Маркова]{Оцінювання характеристик частково спостережуваного ланцюга Маркова на двійкових послідовностях}
\author[Цибульник, Ніщенко]{А.~В.~Цибульник \and І.~І.~Ніщенко}
\institute[Науково-практична конференція студентів]{Всеукраїнська науково-практична конференція студентів, аспірантів та молодих вчених}
\date{2023}

\begin{document}

\begin{frame}
    \titlepage
\end{frame}

\begin{frame}
    \frametitle{План доповіді}
    \tableofcontents
\end{frame}

\AtBeginSection[]
{
  \begin{frame}
    \frametitle{План доповіді}
    \tableofcontents[currentsection]
  \end{frame}
}

%%% --------------------------------------------------------------------
\section{Моделювання об'єкту дослідження}
%%% --------------------------------------------------------------------

\begin{frame}
    \frametitle{\insertsection}
    \begin{columns}
        \begin{column}{0.6\linewidth}
            \begin{overprint}
                \onslide<1-2>\centerline{\input{tikzplot/unit cube.tikz}}
                \onslide<3-4>\centerline{\input{tikzplot/modified unit cube.tikz}}
            \end{overprint}
        \end{column}
        \begin{column}{0.4\linewidth}
            \begin{overprint}
                \onslide<2-3>
                \begin{tblr}{
                        colspec={cc},
                        column{1,2}={mode=math},
                    }
                        & x^t     \\
                    t=1 & (0,1,1) \\
                    t=2 & (0,1,0) \\
                    t=3 & (1,1,0) \\
                    t=4 & (1,0,0) \\
                \end{tblr}
                \onslide<4>
                \begin{tblr}{
                        colspec={ccc},
                        column{1,2,3}={mode=math},
                    }
                        & x^t                                                                       & y^t   \\
                    t=1 & (\textcolor{brown}{0},\textcolor{brown}{1},\textcolor{green!60!black}{1}) & (1,1) \\
                    t=2 & (\textcolor{brown}{0},\textcolor{brown}{1},\textcolor{green!60!black}{0}) & (1,0) \\
                    t=3 & (\textcolor{brown}{1},\textcolor{brown}{1},\textcolor{green!60!black}{0}) & (2,0) \\
                    t=4 & (\textcolor{brown}{1},\textcolor{brown}{0},\textcolor{green!60!black}{0}) & (1,0) \\
                \end{tblr}
            \end{overprint}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{\insertsection}\centering
    \begin{tblr}{
            colspec={ccc},
            column{1,2,3}={mode=math},
        }
            & x^t                                                                                    & y^t  \\
        t=1 & \textcolor{brown}{010}01\textcolor{green!60!black}{11}01\textcolor{green!60!black}{101} & (1,4) \\
        t=2 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}01\textcolor{green!60!black}{101} & (2,4) \\
        t=3 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}11\textcolor{green!60!black}{101} & (2,4) \\
        t=4 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}11\textcolor{green!60!black}{111} & (2,5) \\
    \end{tblr}
\end{frame}

\begin{frame}
    \frametitle{\insertsection}\centering
    \begin{claim}
        Послідовність $\left\{ \left( X^t,Y^t \right) \right\}_{t=\overline{1,T}}$ утворює приховану марковську модель $\left( \pi,A,B \right)$, де 
        \begin{equation*}
            B_{xy}=P\left( Y^t=y\,|\,X^t=x \right) = \prod\limits_{k=1}^{L} \mathbbm{1} \left( y_k=\sum\limits_{i \in I_k} x_i \right)
        \end{equation*} 
    \end{claim}
\end{frame}

%%% --------------------------------------------------------------------
\section{Постановка задачі}
%%% --------------------------------------------------------------------

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[1]
        \item Оцінити параметр $p$ та декодувати послідовність станів прихованого ланцюга;
    \end{enumerate}
    \vspace{1cm}

    \pause
    Метод максимальної правдоподібності:
    \begin{equation*}
        P\, \bigl( Y=y \,|\, p \bigr) = \sum_{x \in E^T} P\, \bigl( X=x,Y=y \,|\, p \bigr) \longrightarrow \max
    \end{equation*}

    \pause
    Відтак
    \begin{equation*}
        \widehat{\,p\,} = \argmax\limits_{p} \sum_{x \in E^T} L_{p,x,y}
    \end{equation*}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[1]
        \item Оцінити параметр $p$ та декодувати послідовність станів прихованого ланцюга;
    \end{enumerate}
    \vspace{1cm}

    Ітераційний алгоритм Баума-Велша: 
    \begin{equation*}
        Q\left( p^{(n)},p \right) = \sum_{x \in E^T}L_{p^{(n)},x,y}\cdot\ln L_{p,x,y} \longrightarrow \max
    \end{equation*}

    \pause
    Тож починаючи з деякого $p^{(0)}$
    \begin{equation*}
        p^{(n+1)} = \argmax\limits_{p} Q\left( p^{(n)},p \right)
    \end{equation*}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[1]
        \item Оцінити параметр $p$ та декодувати послідовність станів прихованого ланцюга;
    \end{enumerate}
    \vspace{1cm}

    Формула переоцінки параметра $p:$
    \begin{equation*}
        p^{(n+1)} = p^{(n)}\cdot\frac{\sum\limits_{t=1}^{T-1}\sum\limits_{x \in E} \alpha_t(x)\,B_{xy^{t+1}}\,\beta_{t+1}(x)}{\sum\limits_{t=1}^{T-1}\sum\limits_{x \in E} \alpha_t(x)\,\beta_t(x)},
    \end{equation*}
    де 
    \begin{align*}
        & \alpha_t(x) = P\left( Y^1=y^1,\ldots,Y^t=y^t,\,X^t=x \,|\, p^{(n)} \right) \\
        & \beta_t(x) = P\left( Y^{t+1}=y^{t+1},\ldots,Y^T=y^T \,|\, X^t=x,\, p^{(n)} \right)
    \end{align*}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[1]
        \item Оцінити параметр $p$ та декодувати послідовність станів прихованого ланцюга;
    \end{enumerate}
    \vspace{1cm}

    Алгоритм Вітербі: пошук такої послідовності прихованих станів $\widehat{X}^1,\widehat{X}^2,\ldots,\widehat{X}^T$, яка найкращим чином описує наявні спостереження:
    \begin{equation*}
        \widehat{X} = \argmax\limits_{x \in E^T} P\left( X=x\,|\,Y=y,\widehat{\,p\,} \right)
    \end{equation*}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}\centering
    \begin{enumerate}[2]
        \item Відтворити елементи <<множини неявних індексів>> $I_*$;
    \end{enumerate}
    \vspace{1cm}

    \pause
    \begin{tblr}{
        colspec={cccc},
        column{1-4}={mode=math},
    }

        & x^t & y^t & y^t_{I_*} \\
    t=1 & \textcolor{brown}{010}01\textcolor{green!60!black}{11}01\textcolor{green!60!black}{101} 
        & (1,4) 
        & 3 \\
    t=2 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}01\textcolor{green!60!black}{101} 
        & (2,4) 
        & 3 \\
    t=3 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}11\textcolor{green!60!black}{101} 
        & (2,4) 
        & 4 \\
    t=4 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}11\textcolor{green!60!black}{111} 
        & (2,5) 
        & 4 \\
    
    \end{tblr}  
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}\centering
    \begin{enumerate}[2]
        \item Відтворити елементи <<множини неявних індексів>> $I_*$;
    \end{enumerate}
    \vspace{1cm}

    \begin{claim}
        Змістовною і незміщеною оцінкою потужності множини $I_*$ є статистика
        \begin{equation*}
            \widehat{|I_*|} = \frac{N}{1-p} \left( 1-\frac{1}{T-1}\sum_{t=1}^{T-1}\mathbbm{1}\left( Y^t_{I_*}=Y^{t+1}_{I_*} \right) \right) 
        \end{equation*}
    \end{claim}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[2]
        \item Відтворити елементи <<множини неявних індексів>> $I_*$;
    \end{enumerate}
    \vspace{1cm}

    Визначення компонент множини $I_*:$
    \begin{equation*}
        \widehat{I\,} = \argmin\limits_{1\leqslant k \leqslant C^{\widehat{|I_*|}}_N}{d\left( \widehat{Y\,}_{\mathtt{I_k}}, Y_{I_*} \right)},
    \end{equation*}

    \pause
    де
    \begin{equation*}
        d_{S}\left( \widehat{Y\,}_{\mathtt{I_k}},Y_{I_*} \right) = \sum_{t=1}^{T}\left( \widehat{Y\,}^t_{\mathtt{I_k}} - Y^t_{I_*} \right)^2
    \end{equation*}
    \begin{equation*}
        d_{J}\left( \widehat{Y\,}_{\mathtt{I_k}},Y_{I_*} \right) = 1 - \frac{\sum\limits_{t=1}^{T}\min{\left( \widehat{Y\,}^t_{\mathtt{I_k}},Y^t_{I_*} \right)}}{\sum\limits_{t=1}^{T}\max{\left( \widehat{Y\,}^t_{\mathtt{I_k}},Y^t_{I_*} \right)}}
    \end{equation*}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}\centering
    \begin{enumerate}[3]
        \item Оцінити невідомий параметр моделі $p$ при ймовірностях спотворення $q_1,q_2,\ldots,q_L$.
    \end{enumerate}
    \vspace{0.5cm}

    \begin{tblr}{
        colspec={ccccc},
        column{1-5}={mode=math},
    }

        & x^t & \widetilde{x}^t & y^t & q \\
    t=1 & \textcolor{brown}{010}01\textcolor{green!60!black}{11}01\textcolor{green!60!black}{101} 
        & 0\textcolor{red}{0}0011101101 
        & (0,4) 
        & (q_1,q_2) \\
    t=2 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}01\textcolor{green!60!black}{101} 
        & 01\textcolor{red}{0}011101101 
        & (1,4) 
        & (q_1,q_2) \\
    t=3 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}11\textcolor{green!60!black}{101} 
        & \textcolor{red}{1}110111111\textcolor{red}{1}1 
        & (3,5)
        & (q_1,q_2) \\
    t=4 & \textcolor{brown}{011}01\textcolor{green!60!black}{11}11\textcolor{green!60!black}{111} 
        & 0110111111\textcolor{red}{00} 
        & (2,3) 
        & (q_1,q_2) \\
    
    \end{tblr}
    \pause  
    \begin{equation*}
        \forall i \in I_1: \quad \widetilde{X}^t_i =
        \begin{cases*}
            1 - X^t_i, & з імовірністю $q_1$ \\
            X^t_i, & з імовірністю $1 - q_1$ \\
        \end{cases*}
    \end{equation*}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[3]
        \item Оцінити невідомий параметр моделі $p$ при ймовірностях спотворення $q_1,q_2,\ldots,q_L$.
    \end{enumerate}
    \vspace{0.5cm}

    \begin{claim}
        Якщо множини $I_1,\ldots,I_L$ є попарно неперетинними, то утворена послідовність $\left\{ \left( X^t,Y^t \right) \right\}_{t=\overline{1,T}}$ є прихованою марковською моделлю $\left( \pi,A,B^q \right)$, де 
        \begin{equation*}
            B^q_{xy} = P\left( Y^t=y\,|\,X^t=x \right) = \prod\limits_{k=1}^{L} P\left( \xi^k_{01}(x) + \xi^k_{11}(x) = y_k \right),
        \end{equation*}
        \begin{equation*}\scaleq[0.82]{
            \xi^k_{01}(x) \sim Bin\left( |I_k| - \sum\limits_{i \in I_k} x_i,\, q_k \right),\ \xi^k_{11}(x) \sim Bin\left( \sum\limits_{i \in I_k} x_i,\, 1 - q_k \right)},\ k=\overline{1,L}
        \end{equation*}
    \end{claim}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[3]
        \item Оцінити невідомий параметр моделі $p$ при ймовірностях спотворення $q_1,q_2,\ldots,q_L$.
    \end{enumerate}
    \vspace{0.5cm}

    \begin{equation*}
        p^{(n+1)} = p^{(n)}\cdot\frac{\sum\limits_{t=1}^{T-1}\sum\limits_{x \in E} \alpha_t(x)\,B^{q^{(n)}}_{xy^{t+1}}\,\beta_{t+1}(x)}{\sum\limits_{t=1}^{T-1}\sum\limits_{x \in E} \alpha_t(x)\,\beta_t(x)}
    \end{equation*}
    \begin{equation*}
        q_k^{(n+1)} = q_k^{(n)}\cdot\frac{\sum\limits_{t=1}^{T}\sum\limits_{x \in E}\beta_{t}(x)\sum\limits_{x' \in E} \alpha_{t-1}(x')\,A^{(n)}_{x'x}\sum\limits_{i \in I_k}P^{q^{(n)}}_{x,i}}{|I_k|\sum\limits_{t=1}^{T}\sum\limits_{x \in E} \alpha_t(x)\,\beta_t(x)}
    \end{equation*}
\end{frame}

%%% --------------------------------------------------------------------
\section{Результати чисельного експерименту}
%%% --------------------------------------------------------------------

\begin{frame}[t]
    \frametitle{\insertsection}
    Було згенеровано прихований ланцюг Маркова протягом $T=200$ моментів часу, $N=5$ та $p=0.2$. Множина спостережуваних індексів: $I=\{I_1,I_2\}=\{(2,3),(1,4)\}$.
    \vspace{1cm}

    \begin{figure}[H]\centering
        \input{tikzplot/input model.tikz}
    \end{figure}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[1]
        \item Оцінити параметр $p$ та декодувати послідовність станів прихованого ланцюга;
    \end{enumerate}

    \begin{columns}
        \begin{column}{0.65\linewidth}
            \begin{figure}[H]
                \input{tikzplot/p estimation.tikz}
            \end{figure}
        \end{column}
        \begin{column}{0.35\linewidth}
            \begin{tblr}{
                hlines,vlines,
                colspec={ccc},
                column{1-3}={mode=math},
                column{2}={l},
                cell{1}{3}={r=2,c=1}{c},
            }

            p               & 0.2    & 0.0041 \\
            \widehat{\,p\,} & 0.1959 &        \\

            \end{tblr}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[1]
        \item Оцінити параметр $p$ та декодувати послідовність станів прихованого ланцюга;
    \end{enumerate}

    \begin{figure}[H]
        \input{tikzplot/decoding task.tikz}
    \end{figure}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[2]
        \item Відтворити елементи <<множини неявних індексів>> $I_*$;
    \end{enumerate}
    \vspace{1cm}

    \begin{figure}[H]\centering
        \input{tikzplot/implicit indices.tikz}
    \end{figure}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[2]
        \item Відтворити елементи <<множини неявних індексів>> $I_*$;
    \end{enumerate}

    \begin{table}
        \caption{Збіжність змістовної оцінки}
        \begin{tblr}{
            hlines,vlines,
            colspec={cccccc},
            row{1-3}={mode=math},
        }

        T               & 200    & 400    & 600    & 800    & 1000    \\
        \widehat{\,p\,} & 0.1959 & 0.1823 & 0.1882 & 0.2099 & 0.2092  \\
        \widehat{|I_*|} & 2      & 2      & 2      & 3      & 3       \\

        \end{tblr}
    \end{table}

    \pause
    \begin{columns}
        \begin{column}{0.5\linewidth}\
            \begin{equation*}
                \widehat{|I_*|}=\max\limits_{1\leqslant t \leqslant T} Y^t_{I_*}
            \end{equation*}
        \end{column}
        \pause
        \begin{column}{0.5\linewidth}\centering
            Отримані результати
            \begin{table}
                \begin{tblr}{
                    hlines,vlines,
                    colspec={cccccc},
                    row{1-3}={mode=math},
                }
        
                I_*             & (1,3,5) \\
                \widehat{I\,}_S & (1,2,5) \\
                \widehat{I\,}_J & (1,2,3) \\
        
                \end{tblr}
            \end{table}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[3]
        \item Оцінити невідомий параметр моделі $p$ при ймовірностях спотворення $q_1,q_2,\ldots,q_L$.
    \end{enumerate}
    \vspace{0.5cm}

    \begin{figure}[H]
        \input{tikzplot/distortion coefficients.tikz}
    \end{figure}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[3]
        \item Оцінити невідомий параметр моделі $p$ при ймовірностях спотворення $q_1,q_2,\ldots,q_L$.
    \end{enumerate}

    \begin{columns}
        \begin{column}{0.65\linewidth}
            \begin{figure}[H]
                \input{tikzplot/p distortion estimation.tikz}
            \end{figure}
        \end{column}
        \begin{column}{0.35\linewidth}
            \begin{tblr}{
                hlines,vlines,
                colspec={ccc},
                column{1-3}={mode=math},
                column{2}={l},
                cell{1}{3}={r=2,c=1}{c},
            }

            p               & 0.2    & 0.0559 \\
            \widehat{\,p\,} & 0.2559 &        \\

            \end{tblr}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}[t]
    \frametitle{\insertsection}
    \begin{enumerate}[3]
        \item Оцінити невідомий параметр моделі $p$ при ймовірностях спотворення $q_1,q_2,\ldots,q_L$.
    \end{enumerate}

    \begin{columns}
        \begin{column}{0.65\linewidth}
            \begin{figure}[H]
                \input{tikzplot/q distortion estimation.tikz}
            \end{figure}
        \end{column}
        \begin{column}{0.35\linewidth}
            \begin{tblr}{
                hlines,vlines,
                colspec={ccc},
                column{1-3}={mode=math},
                column{2}={l},
                cell{1}{3}={r=2,c=1}{c},
            }

            q_1             & 0.05    & 0.0046 \\
            \widehat{q\,}_1 & 0.0454 &         \\

            \end{tblr}
            
            \vspace{0.5cm}
            
            \begin{tblr}{
                hlines,vlines,
                colspec={ccc},
                column{1-3}={mode=math},
                column{2}={l},
                cell{1}{3}={r=2,c=1}{c},
            }

            q_2             & 0.1    & 0.0184 \\
            \widehat{q\,}_2 & 0.1184 &        \\

            \end{tblr}
        \end{column}
    \end{columns}
\end{frame}

\end{document}